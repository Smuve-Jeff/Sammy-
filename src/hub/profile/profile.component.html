<div *ngIf="profile() as p" class="profile-container">

  <!-- Header -->
  <div class="profile-header">
    <div class="banner-container">
      <img [src]="p.bannerUrl" alt="Banner" class="banner-image">
    </div>
    <div class="header-content">
      <div class="avatar-container">
        <img [src]="p.avatarUrl" alt="Avatar" class="avatar-image">
      </div>
      <div class="header-main">
        <div class="handle-section">
          <h1 *ngIf="!isEditing()">{{ p.handle }}</h1>
          <input *ngIf="isEditing()" type="text" [(ngModel)]="editableHandle" class="handle-input"/>
          <div class="header-actions">
            <button class="follow-btn">+ Follow</button>
            <button class="share-btn">Share</button>
            <button *ngIf="!isEditing()" class="edit-profile-btn" (click)="toggleEdit()">Edit Profile</button>
            <button *ngIf="isEditing()" class="edit-profile-btn save" (click)="toggleEdit()">Save</button>
            <button *ngIf="isEditing()" class="edit-profile-btn cancel" (click)="cancelEdit()">Cancel</button>
          </div>
        </div>
        <div class="bio-section">
          <p *ngIf="!isEditing()">{{ p.bio }}</p>
          <textarea *ngIf="isEditing()" [(ngModel)]="editableBio" class="bio-input"></textarea>
        </div>
        <div class="tags-section">
          <span *ngFor="let tag of p.tags" class="tag">{{ tag }}</span>
        </div>
        <div class="links-section">
            <a *ngIf="getLink('twitter')" [href]="getLink('twitter')" target="_blank"><i class="fab fa-twitter"></i></a>
            <a *ngIf="getLink('instagram')" [href]="getLink('instagram')" target="_blank"><i class="fab fa-instagram"></i></a>
            <a *ngIf="getLink('youtube')" [href]="getLink('youtube')" target="_blank"><i class="fab fa-youtube"></i></a>
        </div>
      </div>
    </div>
  </div>

  <!-- Stats -->
  <div class="profile-stats">
      <div *ngFor="let stat of p.stats | keyvalue" class="stat">
          <span class="stat-value">{{ stat.value }}</span>
          <span class="stat-label">{{ stat.key }}</span>
      </div>
  </div>

  <!-- Main Content: Showcase -->
  <div class="profile-content">
    <h2>Showcase</h2>
    <div class="showcase-grid">
      <div *ngFor="let item of p.showcases" class="showcase-card" [class.private]="item.visibility === 'private'">
        <img [src]="item.imageUrl" [alt]="item.title" class="showcase-image">
        <div class="showcase-info">
            <h3>{{ item.title }}</h3>
            <p class="showcase-type">{{item.type}}</p>
        </div>
        <div class="showcase-actions">
            <span class="visibility-badge">{{ item.visibility }}</span>
            <button *ngIf="isEditing()" (click)="toggleVisibility(item)" class="toggle-visibility-btn">
                <i [class.fa-eye]="item.visibility === 'public'" [class.fa-eye-slash]="item.visibility === 'private'" class="fas"></i>
            </button>
        </div>
      </div>
    </div>

    <!-- Add Showcase Form (only in edit mode) -->
    <div *ngIf="isEditing()" class="add-showcase-form">
      <h3>Add New Showcase Item</h3>
      <select [ngModel]="showcaseForm().type" (ngModelChange)="updateShowcaseField('type', $event)">
        <option value="music">Music</option>
        <option value="video">Video</option>
        <option value="project">Project</option>
        <option value="merch">Merch</option>
      </select>
      <input type="text" placeholder="Title" [ngModel]="showcaseForm().title" (ngModelChange)="updateShowcaseField('title', $event)">
      <input type="text" placeholder="URL" [ngModel]="showcaseForm().url" (ngModelChange)="updateShowcaseField('url', $event)">
      <input type="text" placeholder="Image URL" [ngModel]="showcaseForm().imageUrl" (ngModelChange)="updateShowcaseField('imageUrl', $event)">
      <input *ngIf="showcaseForm().type === 'merch'" type="number" placeholder="Price" [ngModel]="showcaseForm().price" (ngModelChange)="updateShowcaseField('price', $event)">
      <button (click)="addShowcaseItem()">Add Item</button>
    </div>
  </div>
</div>
