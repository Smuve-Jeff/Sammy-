<div class="pr-container">
  <div class="pr-toolbar">
    <div class="left">
      <button (click)="togglePlay()" class="btn">{{ isPlaying() ? 'Stop' : 'Play' }}</button>
      <button (click)="resetSequence()" class="btn">Reset</button>
      <label class="lbl">BPM</label>
      <input type="range" min="60" max="240" [value]="bpm()" (input)="onBpmChange($event)">
      <span class="val">{{ bpm() }}</span>
    </div>
    <div class="right">
      <label class="lbl">Instrument</label>
      <select [value]="selectedInstrumentId()" (change)="selectedInstrumentId.set($any($event.target).value)">
        @for(opt of instrumentOptions(); track opt.id) {
          <option [value]="opt.id">{{ opt.name }}</option>
        }
      </select>
      <span class="lbl">Track: {{ trackName() }}</span>
    </div>
  </div>

  <div class="pr-main">
    <div class="pr-ruler">
      <div></div>
      @for(i of steps; track i) {
        <div class="ruler-tick">{{ i + 1 }}</div>
      }
    </div>
    <div class="pr-grid-wrapper">
      <div class="pr-grid" [style.grid-template-columns]="'80px repeat(' + steps.length + ', 1fr)'
           [style.grid-auto-rows]="'24px'">
        <div class="pr-label-col"></div>
        @for(midi of midiRows; track midi) {
          <div class="pr-label">{{ midiName(midi) }}</div>
          @for(i of steps; track i) {
            <div class="pr-cell" (click)="toggleNote(midi, i)"
                 [class.active]="sequenceFor(midi)[i]"
                 [class.playing]="false"></div>
          }
        }
      </div>
    </div>
    <div class="pr-velocity">
      <div class="lane-title">Velocity</div>
      <div class="lane"></div>
    </div>
  </div>
</div>
