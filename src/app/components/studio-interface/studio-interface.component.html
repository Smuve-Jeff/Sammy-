<section class="studio-interface">
  <header class="studio-header">
    <div>
      <h2>Studio Brain — S.M.U.V.E Command</h2>
      <p class="status" [class.recording]="recording()">{{ recordingStatus() }} • {{ pluginLoad() }}</p>
      <p class="latency">Avg latency: {{ latencySummary() }} ms</p>
    </div>
    <div class="recording-toolbar">
      <label class="format-select">
        <span>Format</span>
        <select [ngModel]="selectedFormat()" (ngModelChange)="selectedFormat.set($event)">
          <option *ngFor="let format of recordingFormats" [value]="format">{{ format }}</option>
        </select>
      </label>
      <input type="text" [ngModel]="recordingName()" (ngModelChange)="recordingName.set($event)" placeholder="Session Name" class="session-name">
      <button type="button" (click)="addChannel()" class="ghost-btn">
        <i class="fas fa-plus"></i> Channel
      </button>
      <button type="button" (click)="toggleRecording()" class="record-btn" [class.active]="recording()">
        <span class="dot"></span>
        {{ recording() ? 'Stop Capture' : 'Arm & Record' }}
      </button>
    </div>
  </header>

  <section class="status-strip" *ngIf="recording() || armedChannelLabels().length">
    <div class="status-pill">
      <i class="fas fa-circle" [class.text-red-500]="recording()"></i>
      {{ recording() ? 'Capturing' : 'Armed' }} {{ armedChannelLabels().length }} ch
    </div>
    <div class="status-pill">
      <i class="fas fa-stopwatch"></i>
      {{ formattedElapsed() }}
    </div>
    <div class="status-pill" *ngIf="armedChannelLabels().length">
      <i class="fas fa-sliders-h"></i>
      {{ armedChannelLabels().join(', ') }}
    </div>
  </section>

  <section class="mode-grid">
    <article *ngFor="let mode of modeButtons" class="mode-card">
      <div class="mode-icon"><i [class]="mode.icon"></i></div>
      <div class="mode-copy">
        <h4>{{ mode.label }}</h4>
        <p>{{ mode.description }}</p>
      </div>
      <button type="button" (click)="goToMode(mode.id)">Route</button>
    </article>
  </section>

  <section class="master-grid">
    <article class="master-panel">
      <div class="master-info">
        <h3>Master Output</h3>
        <p>The mixer acts as the engineering hub: compression → limiting → auto-tune are chained here for studio-ready bounce.</p>
      </div>
      <div class="master-controls">
        <label for="masterVolume">Master Volume: {{ masterVolume() }}%</label>
        <input id="masterVolume" type="range" min="0" max="100" [value]="masterVolume()" (input)="updateMasterVolume($any($event.target).valueAsNumber)">
        <div class="quality-flags">
          <label *ngFor="let flag of qualityFlags" class="flag">
            <input type="checkbox"
                   [checked]="qualityProfile()[flag]"
                   (change)="toggleQualityFlag(flag)">
            {{ flag | titlecase }}
          </label>
        </div>
      </div>
      <div class="takes-panel" *ngIf="recordedTakes().length">
        <h4>Captured Prints</h4>
        <div class="takes-list">
          <div *ngFor="let take of recordedTakes()" class="take-row">
            <div>
              <strong>{{ take.name }}</strong>
              <p>{{ formatExtension(take.format) | uppercase }} • {{ (take.durationMs / 1000) | number:'1.1-1' }}s</p>
            </div>
            <div class="take-actions">
              <button type="button" (click)="downloadTake(take)"><i class="fas fa-download"></i></button>
              <button type="button" (click)="deleteTake(take.id)"><i class="fas fa-trash"></i></button>
            </div>
          </div>
        </div>
      </div>
    </article>

    <article class="plugin-rack">
      <header>
        <h3>Studio Plug-in Rack</h3>
        <p>Compressor, limiter, and auto-tune modules share the same signal bus for ultra-low latency commits.</p>
      </header>
      <div class="plugins">
        <div *ngFor="let plugin of pluginRack(); trackBy: trackByPlugin" class="plugin-card" [class.disabled]="!plugin.enabled">
          <header>
            <div>
              <h4>{{ plugin.label }}</h4>
              <p>{{ plugin.description }}</p>
            </div>
            <button type="button" (click)="togglePlugin(plugin)">
              {{ plugin.enabled ? 'Disable' : 'Enable' }}
            </button>
          </header>
          <p class="latency">Latency impact: {{ plugin.latencyImpact }} ms</p>
          <div class="control-grid">
            <label *ngFor="let control of plugin.controls">
              {{ control.label }}
              <input type="range" [min]="control.min" [max]="control.max" [step]="control.step"
                     [value]="plugin.values[control.id]"
                     (input)="updatePluginControl(plugin, control.id, $any($event.target).valueAsNumber)">
              <span>{{ plugin.values[control.id] }}{{ control.unit || '' }}</span>
            </label>
          </div>
        </div>
      </div>
    </article>
  </section>

  <section class="channels">
    <article *ngFor="let channel of micChannels(); trackBy: trackByChannel" class="channel-card" [class.muted]="channel.muted">
      <header>
        <div>
          <h4>{{ channel.label }}</h4>
          <small>{{ channel.connectionType | uppercase }} • {{ channel.category | titlecase }} • {{ channel.latencyMs }}ms</small>
        </div>
        <div class="actions">
          <button type="button" class="arm" [class.active]="channel.armed" (click)="toggleArm(channel)">
            <i class="fas fa-dot-circle"></i>
            {{ channel.armed ? 'Armed' : 'Arm' }}
          </button>
          <button type="button" (click)="toggleMute(channel)">
            <i class="fas" [ngClass]="channel.muted ? 'fa-microphone-slash' : 'fa-microphone'"></i>
            {{ channel.muted ? 'Muted' : 'Live' }}
          </button>
          <button type="button" class="phantom" [class.active]="channel.phantomPower || qualityProfile().phantomPowerBus"
                  (click)="togglePhantomPower(channel)" [disabled]="qualityProfile().phantomPowerBus">
            <i class="fas fa-bolt"></i>
            {{ channel.phantomPower || qualityProfile().phantomPowerBus ? 'Phantom On' : 'Phantom Off' }}
          </button>
          <button type="button" class="ghost-btn" (click)="removeChannel(channel)">
            <i class="fas fa-times"></i>
          </button>
        </div>
      </header>

      <div class="meter" [style.setProperty]="['--meter-level', meterLevelFor(channel.id) + '%']">
        <span>Signal</span>
        <div class="bar"></div>
      </div>

      <div class="slider-group">
        <label>Level: {{ channel.level }}%</label>
        <input type="range" min="0" max="100" [value]="channel.level" (input)="updateChannelLevel(channel, $any($event.target).valueAsNumber)">
      </div>

      <div class="slider-group">
        <label>Pan: {{ channel.pan }}%</label>
        <input type="range" min="-50" max="50" [value]="channel.pan" (input)="updateChannelPan(channel, $any($event.target).valueAsNumber)">
      </div>

      <div class="slider-grid">
        <label>
          Noise Gate: {{ channel.noiseGate }}%
          <input type="range" min="0" max="100" [value]="channel.noiseGate" (input)="updateNoiseGate(channel, $any($event.target).valueAsNumber)">
        </label>
        <label>
          Distortion Guard: {{ channel.distortionGuard }}%
          <input type="range" min="0" max="100" [value]="channel.distortionGuard" (input)="updateDistortionGuard(channel, $any($event.target).valueAsNumber)">
        </label>
      </div>

      <div class="slider-group">
        <label>Latency Trim (ms): {{ channel.latencyMs }}</label>
        <input type="range" min="0" max="20" [value]="channel.latencyMs" (input)="updateLatency(channel, $any($event.target).valueAsNumber)">
      </div>

      <label class="connection-select">
        Connection Type
        <select [value]="channel.connectionType" (change)="updateConnection(channel, $any($event.target).value)">
          <option *ngFor="let type of connectionTypes" [value]="type">{{ type | uppercase }}</option>
        </select>
      </label>
    </article>
  </section>
</section>
