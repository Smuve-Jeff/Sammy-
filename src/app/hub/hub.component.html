<div class="hub-layout">

  <!-- Left Sidebar -->
  <aside class="left-sidebar">
    <app-game-list (gameSelected)="selectGame($event)" [games]="games()"></app-game-list>
  </aside>

  <!-- Main Content -->
  <main class="main-content">
    <header class="main-header">
      <div class="search-bar">
        <i class="fas fa-search"></i>
        <input type="text" placeholder="Search for games..." (input)="onSearch($event)">
      </div>
      <div class="filter-sort-controls">
        <div class="genre-filters">
          <button *ngFor="let genre of genres" 
                  [class.active]="activeFilters().genre === genre" 
                  (click)="setGenre(genre)">{{ genre }}</button>
        </div>
        <div class="sort-options">
          <span>Sort by:</span>
          <button *ngFor="let mode of sortModes" 
                  [class.active]="sortMode() === mode" 
                  (click)="setSort(mode)">{{ mode }}</button>
        </div>
      </div>
    </header>

    <div *ngIf="!selectedGame() && !showBattlefieldLobby()" class="game-grid-container">
      <div class="game-grid">
        <app-game-card *ngFor="let game of games()" 
                       [game]="game" 
                       (click)="selectGame(game)"></app-game-card>
      </div>
    </div>

    <app-game-view *ngIf="selectedGame() && !showBattlefieldLobby()" 
                   [game]="selectedGame()" 
                   (close)="deselectGame()"></app-game-view>

    <!-- "Tha Battlefield" Pre-Match Lobby Overlay -->
    <div *ngIf="showBattlefieldLobby()" class="overlay-backdrop">
      <div class="battlefield-lobby">
        <h2>Tha Battlefield</h2>
        <p>Prepare for a music duel!</p>
        
        <div class="lobby-config">
          <div class="config-group">
            <label for="track-select">Choose Your Weapon (Track):</label>
            <select id="track-select" [ngModel]="battleConfig().track?.url" (ngModelChange)="updateBattleConfig('track', $event)">
              <option [ngValue]="null" disabled>Select a track...</option>
              <option *ngFor="let track of musicShowcases()" [value]="track.url">{{ track.title }}</option>
            </select>
          </div>

          <div class="config-group">
            <label>Mode:</label>
            <div class="radio-group">
              <button [class.active]="battleConfig().mode === 'duel'" (click)="updateBattleConfig('mode', 'duel')">1v1 Duel</button>
              <button [class.active]="battleConfig().mode === 'team'" (click)="updateBattleConfig('mode', 'team')">Team Battle</button>
            </div>
          </div>

          <div class="config-group">
            <label>Round Length:</label>
            <div class="radio-group">
              <button [class.active]="battleConfig().roundLength === 30" (click)="updateBattleConfig('roundLength', 30)">30s</button>
              <button [class.active]="battleConfig().roundLength === 60" (click)="updateBattleConfig('roundLength', 60)">60s</button>
              <button [class.active]="battleConfig().roundLength === 90" (click)="updateBattleConfig('roundLength', 90)">90s</button>
            </div>
          </div>

          <div class="config-group">
            <label>Rounds:</label>
            <div class="radio-group">
              <button [class.active]="battleConfig().rounds === 1" (click)="updateBattleConfig('rounds', 1)">1</button>
              <button [class.active]="battleConfig().rounds === 2" (click)="updateBattleConfig('rounds', 2)">2</button>
              <button [class.active]="battleConfig().rounds === 3" (click)="updateBattleConfig('rounds', 3)">3</button>
            </div>
          </div>
        </div>

        <div class="lobby-actions">
          <button class="secondary-btn" (click)="showBattlefieldLobby.set(false)">Cancel</button>
          <button class="primary-btn" (click)="startBattle()">Start Battle</button>
        </div>
      </div>
    </div>

  </main>

  <!-- Right Sidebar -->
  <aside class="right-sidebar">
    <button (click)="toggleProfile(!showProfile())" class="sidebar-btn">Profile</button>
    <button (click)="toggleChat(!showChat())" class="sidebar-btn">Chat</button>

    <div class="sidebar-content">
        <app-profile *ngIf="showProfile()"></app-profile>
        <app-connections *ngIf="showChat()"></app-connections>
    </div>
  </aside>

</div>
